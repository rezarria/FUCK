//Chu y, code theo chuan C++17/C++20
//Bien dich can dinh cung arg --std=c++20
//Se mat > 5 tieng dong ho de chay xong voi 400 ban ghi, tang den 24000 diem voi 1 luong
//BigO  > 4n^2 :(
#include "lib/subcore.hpp"
//Su dung phan luong, bien dich can co arg -pthread
#include <thread>

void job(std::vector<BanGhi>* record, size_t soLuong, size_t batDau, size_t giaSo)
{
    BoNgauNhien cache;
    cache.chieuDaiToiDa = 100;
    cache.chieuDaiToiThieu = 10;
    cache.tiLeDuong = 100;
    cache.mode = 0;
    *record = plana::simulation_2(cache, soLuong, batDau, giaSo);
}

void run(const int core, const size_t soLuong, size_t batDau, const size_t giaSo)
{
    std::vector<BanGhi> * record  = new std::vector<BanGhi>[core];
    std::vector<std::thread*> thread;
    thread.reserve(core);
    for (size_t i = 0; i < core; ++i)
    {
        record[i].reserve(soLuong / core);
        thread.push_back(new std::thread(job, record + i, soLuong / core, batDau, giaSo));
        batDau += (soLuong / core - 1) * giaSo;
    }
    for (size_t i = 0; i < core; ++i)
        thread[i]->join();
    for (size_t i = 0; i < core; ++i)
        plana::hien_thoi_gian_chay(record[i]);
    delete[] record;
}

int main()
{
    // Cảnh báo ram phải 16GB mới nên chạy!!!
    // Và CPU > 4 core để không thấy tác hại
    // đã hơn 10 phút và ram vẫn nhảy nhót từ 12 đến 14GB
    // 12:05 AM và t muốn đi ngủ 
    run(16, 300, 100, 60);
    return 0;
}

/*
  100 : 5300
  160 : 12400
  220 : 15900
  280 : 25100
  340 : 43600
  400 : 59100
  460 : 59900
  520 : 89000
  580 : 139700
  640 : 195400
  700 : 655000
  760 : 982200
  820 : 913100
  880 : 1108300
  940 : 1269900
 1000 : 1484400
 1060 : 1619500
 1120 : 1957200
 1180 : 2471700
 1240 : 2217500
 1300 : 2548200
 1360 : 4123900
 1420 : 2774500
 1480 : 2972400
 1540 : 3006700
 1600 : 3191300
 1660 : 3537200
 1720 : 3729200
 1780 : 4104000
 1840 : 3505400
 1900 : 4679900
 1960 : 4629200
 2020 : 4376900
 2080 : 5232900
 2140 : 4819600
 2200 : 5089300
 2260 : 5296700
 2320 : 5964700
 2380 : 14718300
 2440 : 6858900
 2500 : 7924700
 2560 : 7757000
 2620 : 7377700
 2680 : 8614600
 2740 : 7695600
 2800 : 8470100
 2860 : 8964200
 2920 : 9693600
 2980 : 20872000
 3040 : 11195300
 3100 : 14260700
 3160 : 11358300
 3220 : 12910300
 3280 : 12321300
 3340 : 12279200
 3400 : 12570300
 3460 : 14323400
 3520 : 17241200
 3580 : 15087500
 3640 : 16820300
 3700 : 17632700
 3760 : 25146300
 3820 : 22869300
 3880 : 38749700
 3940 : 22187500
 4000 : 20088400
 4060 : 17231500
 4120 : 20514200
 4180 : 24007900
 4240 : 20301600
 4300 : 18661800
 4360 : 19796000
 4420 : 22973200
 4480 : 20667500
 4540 : 22434700
 4600 : 22676000
 4660 : 23882200
 4720 : 38491000
 4780 : 69499200
 4840 : 30558400
 4900 : 29391000
 4960 : 28730100
 5020 : 59604200
 5080 : 25106100
 5140 : 27303200
 5200 : 33119800
 5260 : 27622400
 5320 : 23660500
 5380 : 27506100
 5440 : 32638400
 5500 : 30269200
 5560 : 31549200
 5620 : 34604400
 5680 : 33179500
 5740 : 29331100
 5800 : 33929100
 5860 : 78748800
 5920 : 32609400
 5980 : 38078800
 6040 : 43591300
 6000 : 40556800
 6060 : 57675900
 6120 : 41343200
 6180 : 41196000
 6240 : 47658800
 6300 : 46860200
 6360 : 50757900
 6420 : 63549300
 6480 : 62938400
 6540 : 43831200
 6600 : 97655300
 6660 : 52470700
 6720 : 46796300
 6780 : 46609100
 6840 : 135337400
 6900 : 70003800
 6960 : 52301800
 7020 : 60537400
 7080 : 61351500
 7140 : 55515300
 7200 : 47127200
 7260 : 57505500
 7320 : 58428600
 7380 : 61515900
 7440 : 44665600
 7500 : 107559700
 7560 : 47325300
 7620 : 62817500
 7680 : 47228700
 7740 : 60141400
 7800 : 62556500
 7860 : 57100100
 7920 : 53473300
 7980 : 56969700
 8040 : 61171200
 8100 : 59051000
 8160 : 69029200
 8220 : 73869200
 8280 : 68881400
 8340 : 63985800
 8400 : 68338800
 8460 : 64456800
 8520 : 65787700
 8580 : 76402300
 8640 : 70931300
 8700 : 77835600
 8760 : 69560000
 8820 : 81528900
 8880 : 63765900
 8940 : 71181900
 9000 : 72255500
 9060 : 82844200
 9120 : 65909300
 9180 : 81071700
 9240 : 76766200
 9300 : 85102100
 9360 : 111829100
 9420 : 89273500
 9480 : 179981800
 9540 : 93765200
 9600 : 131899200
 9660 : 73586400
 9720 : 96666500
 9780 : 83005700
 9840 : 90000700
 9900 : 110043100
 9960 : 94470200
10020 : 99891200
10080 : 102882000
10140 : 106683200
10200 : 93041800
10260 : 111871900
10320 : 89540600
10380 : 138008000
10440 : 106511100
10500 : 99313100
10560 : 111611200
10620 : 100895300
10680 : 113675000
10740 : 108446800
10800 : 118321700
10860 : 115824800
10920 : 113283200
10980 : 99530300
11040 : 132918100
11100 : 110136300
11160 : 121089800
11220 : 134711900
11280 : 100627700
11340 : 132158400
11400 : 109789700
11460 : 135563800
11520 : 121960200
11580 : 132825200
11640 : 120911900
11700 : 118953300
11760 : 134246300
11820 : 130294600
11880 : 115383200
11940 : 137276400
11900 : 186552700
11960 : 184035800
12020 : 236796600
12080 : 166455600
12140 : 203252000
12200 : 135363800
12260 : 138618100
12320 : 161763200
12380 : 165685200
12440 : 124848500
12500 : 127510500
12560 : 143897800
12620 : 129524600
12680 : 254131900
12740 : 148741900
12800 : 137706500
12860 : 168950700
12920 : 154993700
12980 : 162426900
13040 : 142720900
13100 : 172806900
13160 : 193719200
13220 : 172582700
13280 : 139775000
13340 : 194879700
13400 : 166592700
13460 : 197032700
13520 : 191137700
13580 : 140645300
13640 : 217850900
13700 : 175737400
13760 : 265435400
13820 : 196162400
13880 : 180294800
13940 : 214817000
14000 : 185043900
14060 : 220102000
14120 : 187892100
14180 : 242980300
14240 : 231571900
14300 : 205652100
14360 : 168949400
14420 : 169672100
14480 : 222889200
14540 : 175792500
14600 : 165111400
14660 : 173413300
14720 : 161989600
14780 : 191391100
14840 : 250224200
14900 : 174818100
14960 : 201631600
15020 : 168618300
15080 : 193395400
15140 : 173965300
15200 : 209916100
15260 : 173061200
15320 : 210331000
15380 : 187918000
15440 : 193236600
15500 : 178190300
15560 : 210273900
15620 : 185450600
15680 : 218265800
15740 : 196516300
15800 : 231162800
15860 : 198168500
15920 : 218961600
15980 : 200492800
16040 : 222552200
16100 : 212970300
16160 : 210293000
16220 : 199901600
16280 : 230755400
16340 : 212584700
16400 : 225180600
16460 : 237106000
16520 : 241463900
16580 : 278546700
16640 : 208785700
16700 : 233324600
16760 : 246377900
16820 : 249140600
16880 : 220093000
16940 : 239471800
17000 : 260282900
17060 : 233817400
17120 : 299942300
17180 : 220518000
17240 : 234699600
17300 : 241216300
17360 : 239866500
17420 : 235156900
17480 : 239916500
17540 : 246270300
17600 : 246474400
17660 : 278548600
17720 : 263232400
17780 : 301392000
17840 : 243300900
17800 : 421953000
17860 : 540492700
17920 : 348982900
17980 : 263073000
18040 : 328653100
18100 : 333664800
18160 : 393167200
18220 : 310299000
18280 : 370270800
18340 : 310905700
18400 : 295612900
18460 : 386303800
18520 : 403767500
18580 : 300432700
18640 : 399175100
18700 : 329319200
18760 : 279514100
18820 : 274692900
18880 : 377620200
18940 : 335599400
19000 : 329171300
19060 : 424111400
19120 : 345744000
19180 : 352640300
19240 : 387566300
19300 : 382899300
19360 : 281940800
19420 : 371905000
19480 : 379136700
19540 : 344679600
19600 : 312786200
19660 : 354489000
19720 : 318515900
19780 : 351906300
19840 : 362661900
19900 : 321484100
19960 : 344072000
20020 : 353727900
20080 : 325887700
20140 : 406455300
20200 : 307630400
20260 : 314938100
20320 : 415298800
20380 : 366447400
20440 : 312368200
20500 : 338364600
20560 : 330185600
20620 : 348150800
20680 : 320967100
20740 : 348078800
20800 : 384136400
20860 : 336263100
20920 : 327376500
20980 : 385868900
21040 : 418168100
21100 : 328169200
21160 : 339399800
21220 : 364186600
21280 : 369694500
21340 : 397416700
21400 : 363919000
21460 : 356166900
21520 : 392360300
21580 : 354905500
21640 : 345014400
21700 : 358254100
21760 : 366892000
21820 : 455666900
21880 : 375482800
21940 : 383020200
22000 : 374508300
22060 : 359443700
22120 : 434587900
22180 : 400030600
22240 : 392222500
22300 : 420159800
22360 : 387658400
22420 : 519946600
22480 : 423710000
22540 : 428195100
22600 : 406175700
22660 : 421748700
22720 : 450005800
22780 : 435322500
22840 : 456172100
22900 : 528997500
22960 : 431326700
23020 : 463682300
23080 : 462409900
23140 : 403607300
23200 : 399017300
23260 : 416804700
23320 : 433769000
23380 : 404004600
23440 : 416076400
23500 : 408107900
23560 : 412363500
23620 : 413629800
23680 : 477655900
23740 : 430297700
*/